<!DOCTYPE html>
<html lang="en">

<head>
    <title> A peer-to-peer music recommender </title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width-device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <script
    src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>

    <link href="https://sp-bootstrap.global.ssl.fastly.net/8.0.0/sp-bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}"> 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>


<body> 
    {% if not ids %}
        <p class="p1-error"> Oops! It seems like there are no songs we can recommend 
            from this selection of mood, genre and recommendation threshold. 
            Please try again!
        </p>
    {% else %}


    <h3 class="hl title"> Here's a playlist of songs from Janna's library tailored to Antoine's music taste: </h3>

    <div class="container div-songs"> 
        <div class="sep-center" style="padding-top: 50px;">
                <table class="tbl-songs">
                {% for id in ids %}
                <tr>
                    <iframe src="https://open.spotify.com/embed/track/{{ id }}" width="300" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media" ></iframe>
                </tr>
                {% endfor %}
                </table>
        </div>

        <form action="/save_playlist" method="POST">
            <div style="text-align:center;">
                <input type="submit" id="save-playlist" value="Save this playlist to my own library" class="btn btn-green btn-sm" style="padding: 2%;"/>
                {% if pl_saved %}
                    <p class="p1-success" id="p1-success"> Playlist successfully saved! </p>
                {% endif %}
            </div>


        </form>
    </div>

    <div class="container div-info">

        {% if mood != "no preference" %}
            <p class="p1"> 
                Based on <a href="https://developer.spotify.com/documentation/web-api/reference/tracks/get-audio-features/">certain Spotify-generated attributes</a>, 
                these songs have a 
                <span style="font-weight: bold;"> {{ mood }} </span>
                mood.
            </p>
        {% endif %}

        <p class="p1"> 
            {% if "surprise me" in genres %}
                <p  style="font-size: 20px;"> This playlist has songs from a bunch of different genres! </p>
            
            {% else %}
            <p class="p1">  The playlist includes songs from the following genres:
                    {{ genres|join(', ') }}
                </p>
            {% endif %}
        </p> 

        <p class="p1-padding"> 
            Each of these songs has at least <span style="font-weight: bold;">{{thresh}}</span> probability that Antoine will 
            like the song, based on the trained machine learning model.
        </p>
        {% endif %}
        <p class="btn-center">
            <a href=pick_prefs ><button class="btn btn-salmon btn-lg">Generate another playlist!</button></a>
        </p>

        <p class="sep-center">
            <a> 
                <button class="btn-storm btn-circle" data-toggle="modal" data-target="#myModal"> 
                    <img src="{{ url_for('static', filename='question.png') }}" class="icon-img">  
                </button> 
            </a>
            <a href="https://www.linkedin.com/in/janna-agustin/" target="_blank"> 
                <button class="btn-storm btn-circle"> 
                    <img src="{{ url_for('static', filename='linkedin.png') }}" class="icon-img">
                </button> 
            </a>
            <a href="https://github.com/jannalouisea/discover_friendly_app" target="_blank"> 
                <button class="btn-storm btn-circle"> <img src="{{ url_for('static', filename='gh.svg') }}"> 
                </button> 
            </a>
        </p>


        <!-- MODAL POP-UP FOR TECH EXPLANATION -->
        <div class="container">
            
            <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog modal-lg">
            
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h3 class="modal-title" style="font-weight: bold; text-align: center;">For the Techies</h3>
                    </div>
                    <div class="modal-body">
                        <p class="p1" style="padding-bottom: 15px; light-height: 180%;">These songs are recommended based on predictions by a 
                            Random Forest model, which was trained with 71% accuracy
                            on Antoine’s song data from Spotify.
                        </p>
                        <p class="p2"> <span style="font-style: italic; font-weight: bold; font-size: 18px;"> Data Collection</span> <br>
                            Over a period of a few months, Antoine classified over 2300 songs on Spotify as one of two categories – 
                            liked or disliked. With help from the python library 
                            <a href="https://spotipy.readthedocs.io/en/2.9.0/#">spotipy</a>,
                            I collected 16 attributes for each song, which I then used to train the predictive
                            model. These attributes include musical metrics created by Spotify 
                            developers, like danceability, liveness and speechiness. They also 
                            include standard musical qualities, like tempo, duration and time signature. Additionally, 
                            I collected attributes related to the popularity of the song, its 
                            artist and the album. </p>
                            <p class="p2"> <span style="font-style: italic; font-weight: bold; font-size: 18px;"> Model Selection </span> <br>
                            Using the 
                            <a href="https://scikit-learn.org/stable/">scikit-learn library</a>,
                            I trained 7 models (including SVM, Naive Bayes, KNN – to name a few) 
                            and evaluated each using 10-fold cross validation. The Random Forest returned the highest accuracy 
                            of 0.71 and the highest ROC AUC score of 0.77. The ROC AUC was a relevant metric given 
                            the nature of this classification task; one's opinion on a song is usually a bit more nuanced and 
                            is hardly ever binary. Because of this, I chose to have the Random Forest model output 
                            <span style="font-style: italic;">probabilities</span> that Antoine will like a song,
                            as opposed to binary 0-1 values. 
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-storm" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function techPopUp() {
            document.getElementById("tech_pop_up") = "TBA!"
        }

        function disable() {
            if (document.getElementsByClassName("p1-error")!= null) {
                document.getElementById("save-playlist").disabled = true;
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            if (document.getElementById('p1-success') != null) {
                setTimeout(function(){
                    document.getElementById('p1-success').innerHTML = "";
                },3000);
            }
        });
        
    </script>



</body>
</html>